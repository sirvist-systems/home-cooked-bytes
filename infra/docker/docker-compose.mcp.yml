name: home-cooked-bytes

# Update (UTC): 2026-02-13 17:50:53Z

services:
  redis:
    image: redis:7.2-alpine
    container_name: hcb_redis
    ports:
      - "6381:6379"
    volumes:
      - hcb_redis_data:/data

  postgres:
    image: postgres:16.3
    container_name: hcb_postgres
    ports:
      - "5433:5432"
    environment:
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - hcb_postgres_data:/var/lib/postgresql/data

  # Shared env file provides secrets/URLs; keep it consistent with `.env.example`.

  neo4j:
    image: neo4j:5.18.1
    container_name: hcb_neo4j
    ports:
      - "7475:7474"
      - "7688:7687"
    environment:
      NEO4J_AUTH: "neo4j/${NEO4J_PASSWORD}"
      NEO4J_PLUGINS: '["apoc", "graph-data-science"]'
      NEO4J_dbms_security_procedures_unrestricted: "apoc.*,gds.*"
      NEO4J_dbms_security_procedures_allowlist: "apoc.*,gds.*"
    volumes:
      - hcb_neo4j_data:/data

  weaviate:
    image: semitechnologies/weaviate:1.24.1
    container_name: hcb_weaviate
    ports:
      - "8092:8080"
    environment:
      QUERY_DEFAULTS_LIMIT: 25
      AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: "true"
      PERSISTENCE_DATA_PATH: "/var/lib/weaviate"
    volumes:
      - hcb_weaviate_data:/var/lib/weaviate

  langflow:
    image: langflowai/langflow:1.7.2
    container_name: hcb_langflow
    ports:
      - "7861:7860"
    environment:
      LANGFLOW_LOG_LEVEL: "INFO"

  langgraph:
    # Open-source local LangGraph dev server (no LangSmith license required).
    # Mirrors the sirvist-lab `langgraph_deepagents_backend_sirvist` pattern.
    image: python:3.12-slim
    container_name: hcb_langgraph
    ports:
      - "2026:2024"
    # Run as the host user to avoid root-owned files on bind mounts.
    # Uses shell defaults if UID/GID are unset.
    user: "${UID:-1000}:${GID:-1001}"
    environment:
      # Disable external telemetry/tracing.
      LANGCHAIN_TRACING_V2: "false"
      LANGSMITH_TRACING: "false"
      # If your graph routes model calls via Bifrost, keep these available.
      BIFROST_URL: ${BIFROST_URL}
      BIFROST_API_KEY: ${BIFROST_API_KEY}
      # Ensure Python user installs have a writable home.
      HOME: /tmp
      PIP_CACHE_DIR: /tmp/pip-cache
    depends_on:
      - bifrost
    volumes:
      - ../langgraph_deepagents_backend:/app:rw
    command:
      - bash
      - -lc
      - |
        python -m pip install -U pip && \
        python -m pip install --no-warn-script-location "langgraph-cli[inmem]" langgraph && \
        export PATH="/tmp/.local/bin:$PATH" && \
        cd /app && langgraph dev --host 0.0.0.0 --port 2024 --config /app/langgraph.json --no-browser --no-reload

  ollama:
    image: ollama/ollama:latest
    container_name: hcb_ollama
    ports:
      - "11436:11434"
    volumes:
      - hcb_ollama_data:/root/.ollama

  bifrost:
    image: sirvist-lab-bifrost
    container_name: hcb_bifrost
    ports:
      - "8084:8080"
    user: "root"
    environment:
      BIFROST_URL: ${BIFROST_URL}
      BIFROST_API_KEY: ${BIFROST_API_KEY}
      APP_DIR: /app/data
      BIFROST_CONFIG: /app/bifrost_config/config.json
      XDG_CONFIG_HOME: /app/data
      HOME: /app/data
    # The image attempts to check for updates on startup. If network/DNS is unreliable,
    # consider pinning or disabling update checks inside the image.
    volumes:
      - ./bifrost:/app/bifrost_config:rw
      - hcb_bifrost_global_data:/app/data
      - ${GOOGLE_APPLICATION_CREDENTIALS}:/app/creds/service-account.json:ro
    entrypoint:
      - sh
      - -lc
      - |
        mkdir -p /app/data && \
        chown -R ${UID:-1000}:${GID:-1001} /app/data && \
        exec su node -s /bin/sh -c 'exec docker-entrypoint.sh bifrost start --host 0.0.0.0 --port 8080 -app-dir /app/data'

    # Avoid DNS/update checks during startup by running the server binary directly.
    # (The Node wrapper in the image may attempt to fetch `getbifrost.ai`.)
    command:
      - bifrost
      - start
      - --host
      - 0.0.0.0
      - --port
      - "8080"
      - -app-dir
      - /app/data

  bifrost_us_central1:
    image: sirvist-lab-bifrost
    container_name: hcb_bifrost_us_central1
    ports:
      - "8082:8080"
    user: "root"
    environment:
      BIFROST_URL: ${BIFROST_US_CENTRAL1_URL}
      BIFROST_API_KEY: ${BIFROST_US_CENTRAL1_API_KEY}
      VERTEX_REGION: ${VERTEX_REGION_US_CENTRAL1}
      APP_DIR: /app/data
      BIFROST_CONFIG: /app/bifrost_config/config.json
      XDG_CONFIG_HOME: /app/data
      HOME: /app/data
    volumes:
      - ./bifrost:/app/bifrost_config:rw
      - hcb_bifrost_us_central1_data:/app/data
      - ${GOOGLE_APPLICATION_CREDENTIALS}:/app/creds/service-account.json:ro
    entrypoint:
      - sh
      - -lc
      - |
        mkdir -p /app/data && \
        chown -R ${UID:-1000}:${GID:-1001} /app/data && \
        exec su node -s /bin/sh -c 'exec docker-entrypoint.sh bifrost start --host 0.0.0.0 --port 8080 -app-dir /app/data'

  bifrost_us_south1:
    image: sirvist-lab-bifrost
    container_name: hcb_bifrost_us_south1
    ports:
      - "8083:8080"
    user: "root"
    environment:
      BIFROST_URL: ${BIFROST_US_SOUTH1_URL}
      BIFROST_API_KEY: ${BIFROST_US_SOUTH1_API_KEY}
      VERTEX_REGION: ${VERTEX_REGION_US_SOUTH1}
      APP_DIR: /app/data
      BIFROST_CONFIG: /app/bifrost_config/config.json
      XDG_CONFIG_HOME: /app/data
      HOME: /app/data
    volumes:
      - ./bifrost:/app/bifrost_config:rw
      - hcb_bifrost_us_south1_data:/app/data
      - ${GOOGLE_APPLICATION_CREDENTIALS}:/app/creds/service-account.json:ro
    entrypoint:
      - sh
      - -lc
      - |
        mkdir -p /app/data && \
        chown -R ${UID:-1000}:${GID:-1001} /app/data && \
        exec su node -s /bin/sh -c 'exec docker-entrypoint.sh bifrost start --host 0.0.0.0 --port 8080 -app-dir /app/data'

volumes:
  hcb_redis_data:
  hcb_postgres_data:
  hcb_neo4j_data:
  hcb_weaviate_data:
  hcb_ollama_data:
  hcb_bifrost_global_data:
  hcb_bifrost_us_central1_data:
  hcb_bifrost_us_south1_data:
